<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>Chinese tones training</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
<body class="container">

<h1 class="mt-3">Chinese tones training</h1>

<p class="mt-3 mb-3">
	<input id="btn-playrandom" type="button" class="btn btn-primary mt-5 me-2" value="Play random">
	<input id="btn-repeat" type="button" class="btn btn-secondary mt-5 me-2" value="Repeat last">	
	<input id="btn-answer" type="button" class="btn btn-success mt-5 me-2" data-bs-toggle="collapse" data-bs-target="#answer" aria-expanded="false" aria-controls="answer" value="Show answer">	
	<input id="btn-showaudio" type="button" class="btn btn-info mt-5 me-2" value="Show audio">
</p>

<div id="answer" class="collapse mb-3">Start text first.</div>

<div id="audiolist" class="collapse">
	<div>
		<audio controls data-name="ma 1" src="mp3/ma/1.mp3"></audio>
		<audio controls data-name="ma 2" src="mp3/ma/2.mp3"></audio>
		<audio controls data-name="ma 3" src="mp3/ma/3.mp3"></audio>
		<audio controls data-name="ma 4" src="mp3/ma/4.mp3"></audio>
		<audio controls data-name="ma 0" src="mp3/ma/0.mp3"></audio>
	</div>

	<div>
		<audio controls data-name="xing 1" src="mp3/xing/1.mp3"></audio>
		<audio controls data-name="xing 2" src="mp3/xing/2.mp3"></audio>
		<audio controls data-name="xing 3" src="mp3/xing/3.mp3"></audio>
		<audio controls data-name="xing 4" src="mp3/xing/4.mp3"></audio>
	</div>

	<div>
		<audio controls data-name="xing 1" src="mp3/xue/1.mp3"></audio>
		<audio controls data-name="xing 2" src="mp3/xue/2.mp3"></audio>
		<audio controls data-name="xing 3" src="mp3/xue/3.mp3"></audio>
		<audio controls data-name="xing 4" src="mp3/xue/4.mp3"></audio>
	</div>

	<div>
		<audio controls data-name="zhu 1" src="mp3/zhu/1.mp3"></audio>
		<audio controls data-name="zhu 2" src="mp3/zhu/2.mp3"></audio>
		<audio controls data-name="zhu 3" src="mp3/zhu/3.mp3"></audio>
		<audio controls data-name="zhu 4" src="mp3/zhu/4.mp3"></audio>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" type="text/javascript" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>

<script>
"use strict";

let lastPlayed = null;

function initUI() {
	document.getElementById("btn-playrandom").onclick = function(event) {
		setTimeout(playRandom, 10);
		return false;
	}

	document.getElementById("btn-repeat").onclick = function(event) {
		setTimeout(playLastAgain, 10);
		return false;
	}

	document.getElementById("btn-showaudio").onclick = function(event) {
		document.getElementById("audiolist").classList.toggle("show");
		return false;
	}
}

initUI();

function playRandom() {

	document.getElementById("answer").classList.remove("show");

	let audioList = document.querySelectorAll("audio");
	let rnd = Math.floor(Math.random()*audioList.length); // random index [0..audioList.length-1]

	let audio = document.querySelectorAll("audio")[rnd];
	audio.play();

	lastPlayed = rnd;

	let audioURL = audio.currentSrc;
	let audioName = audio.dataset.name;

	let answer;

	if (audioName) {
		answer = audioName;
	}
	else {
		answer = audioURL;
	}

	document.getElementById("answer").innerHTML = answer;
}

function playLastAgain() {

	if (lastPlayed !== null) {
		let audio = document.querySelectorAll("audio")[lastPlayed];

		if (audio) {
			audio.play();
		}
	}

}

</script>
